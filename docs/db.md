---
title: Базы данных
description: Вопросы и ответы по базам данных на сайте-методичке Python FAQ.
---
## Как реализовать логику подключения к бд без контекстного менеджера?
Для реализации логики подключения к базе данных без использования контекстного менеджера в Python обычно применяют классические подходы с явным открытием и закрытием соединения. Это делается с помощью вызова методов для создания подключения и закрытия его вручную, а также обработки исключений для корректного завершения.

**Основные шаги:**

1. Создать подключение к базе данных через соответствующий драйвер (например, psycopg2 для PostgreSQL).

2. Выполнить необходимые запросы.

3. Явно закрыть курсор и подключение после выполнения работы, чтобы не было утечек ресурсов.

4. Обработать возможные ошибки через `try-except`.

Пример с psycopg2 без контекстного менеджера:
```python
import psycopg2

try:
    conn = psycopg2.connect(
        dbname="mydb",
        user="user",
        password="password",
        host="localhost"
    )
    cursor = conn.cursor()
    
    cursor.execute("SELECT * FROM my_table")
    results = cursor.fetchall()
    print(results)
    
    cursor.close()
    conn.close()
except Exception as e:
    print("Ошибка при работе с БД:", e)
    if conn:
        conn.close()
```
Особенности:

* Без контекстного менеджера нужно явно закрывать ресурсы (курсоры и подключения).

* В try-except важно также гарантировать закрытие подключения при ошибках (можно использовать finally).

* Такой подход менее удобен и подвергается риску забыть закрыть соединение, из-за чего возможны утечки.

Для более надежной работы всё же рекомендуется использовать контекстные менеджеры, но если по каким-то причинам они недоступны, описанный подход работает корректно.